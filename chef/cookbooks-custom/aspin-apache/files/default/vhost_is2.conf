<VirtualHost *:80>
  ServerName is2.d
  DocumentRoot /home/projects/is2/www
  
  LogFormat       "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined
  CustomLog       /var/log/httpd/is2-access.log combined
  ErrorLog        /var/log/httpd/is2-error.log
  
  SetEnv APPLICATION_ENV "development"
  
  <IfModule mpm_itk_module>
    AssignUserId vagrant vagrant
  </IfModule>

  <Directory /home/projects/is2/www>
    Order allow,deny
    Allow from all
    AllowOverride all
  </Directory>

# ------------------------------------------------------------------------------
# MOD-REWRITE RULES
# PLEASE NOTE! These rules are for local development only.
# They are NOT the same as the production ones found in
# the .htaccess file
# ------------------------------------------------------------------------------

RewriteEngine on

# Check for static files/scripts on the store
# ------------------------------------------------------------------------------
RewriteCond %{DOCUMENT_ROOT}/intersell2-store/$2 -f
RewriteRule ^/([^/]+)/(.+)$ /intersell2-store/$2 [L]  

# Rule for homepage
# ------------------------------------------------------------------------------
RewriteRule ^/([^/]+)/?$ /intersell2-store/index.php [L]

# SECTION A: std rules
# ------------------------------------------------------------------------------
# Product detail links from product list

# A1, example: product/some_sku/search_type/search_param/product_title.html
RewriteRule ^/([^/]+)/product/([A-Za-z0-9-_*=\.]+)/([0-9]+)/([A-Za-z0-9-_*\s\@\+]+)/(.+)\.html$ /intersell2-store/product/product_detail.php?SKU=$2&list_type=$3&list_value=$4 [L]

# A2, example: product/some_sku/search_type/search_param/
RewriteRule ^/([^/]+)/product/([A-Za-z0-9-_*=\.]+)/([0-9]+)/([A-Za-z0-9-_*\s\@\+]+)/$ /intersell2-store/product/product_detail.php?SKU=$2&list_type=$3&list_value=$4 [L]

# ------------------------------------------------------------------------------
# Product detail direct links

# A3, example: product/some_sku/
RewriteRule ^/([^/]+)/product/([A-Za-z0-9-_*=\.]+)/$ /intersell2-store/product/product_detail.php?SKU=$2 [L]

# A4, example: product/some_sku/product_title.html
RewriteRule ^/([^/]+)/product/([A-Za-z0-9-_*=\.]+)/([^/\.]+)\.html$ /intersell2-store/product/product_detail.php?SKU=$2 [L]

# A4a, example: product/some_sku/product.title.html [ same as A4 but allows full stops in product title ]
RewriteRule ^/([^/]+)/product/([A-Za-z0-9-_*=\.]+)/([^/]+)\.html$ /intersell2-store/product/product_detail.php?SKU=$2 [L]

# A5, example: product/some_sku (currently can't allow skus with .'s as .php files match)
RewriteRule ^/([^/]+)/product/([A-Za-z0-9-_*=]+)$ /intersell2-store/product/product_detail.php?SKU=$2 [L]

# ------------------------------------------------------------------------------
# Product Groups & Product Lists

# A6, example: productgroup/prod_grp_id/prod_group_title.html
RewriteRule ^/([^/]+)/productgroup/([0-9]+)/(.+)\.html$ /intersell2-store/product/product_group_homepage.php?ProductGroupId=$2 [L]

# A7, example: productsubgroup1/prod_sub_grp1_id/prod_sub_grp1_title.html
RewriteRule ^/([^/]+)/productsubgroup1/([0-9]+)/(.+)\.html$ /intersell2-store/product/product_sub_group1_homepage.php?ProductSubGroup1Id=$2 [L]

# A8, example: productlist/list_type/list_param/list_title.html
RewriteRule ^/([^/]+)/productlist/([0-9]+)/([A-Za-z0-9-_*\s+%']+)/([^\.]+)\.html$ /intersell2-store/product/product_list.php?list_type=$2&list_value=$3 [L]

# ------------------------------------------------------------------------------

# SECTION B: lang / country
# ------------------------------------------------------------------------------
# Product detail links from product list

# B1, example: /lang/COUNTRY/product/some_sku/search_type/search_param/product_title.html
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=]+)/([0-9]+)/([A-Za-z0-9-_*]+)/(.+)\.html$ /intersell2-store/product/product_detail.php?l=$2&c=$3&SKU=$3&list_type=$5&list_value=$6 [L]

# B2, example: /lang/COUNTRY/product/some_sku/search_type/search_param/
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=]+)/([0-9]+)/([A-Za-z0-9-_*]+)/$ /intersell2-store/product/product_detail.php?l=$2&c=$3&SKU=$4&list_type=$5&list_value=$6 [L]

# ------------------------------------------------------------------------------
# Product detail direct links

# B3, example: /lang/COUNTRY/product/some_sku/
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=\.]+)/$ /intersell2-store/product/product_detail.php?l=$2&c=$3&SKU=$4 [L]

# B4, example: /lang/COUNTRY/product/some_sku/product_title.html
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=\.]+)/([^/\.]+)\.html$ /intersell2-store/product/product_detail.php?l=$2&c=$3&SKU=$4 [L]

# B5, example: /lang/COUNTRY/product/some_sku
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=]+)$ /intersell2-store/product/product_detail.php?l=$2&c=$3&SKU=$4 [L]

# ------------------------------------------------------------------------------
# Product Groups & Product Lists

# B6, example: /lang/COUNTRY/productgroup/prod_grp_id/prod_group_title.html
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/productgroup/([0-9]+)/(.+)\.html$ /intersell2-store/product/product_group_homepage.php?l=$2&c=$3&ProductGroupId=$4 [L]

# B7, example: /lang/COUNTRY/productsubgroup1/prod_sub_grp1_id/prod_sub_grp1_title.html
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/productsubgroup1/([0-9]+)/(.+)\.html$ /intersell2-store/product/product_sub_group1_homepage.php?l=$2&c=$3&ProductSubGroup1Id=$4 [L]

# B8, example: /lang/COUNTRY/productlist/list_type/list_param/list_title.html
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/productlist/([0-9]+)/([0-9]+)/([^\.]+)\.html$ /intersell2-store/product/product_list.php?l=$2&c=$3&list_type=$4&list_value=$5 [L]

# ------------------------------------------------------------------------------

# SECTION C: lang / country / content items
# ------------------------------------------------------------------------------
# lang / country content item

# C1, example: /lang/COUNTRY/content_page_title(/)
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/([A-Za-z0-9-_*]+)(/?)$ /intersell2-store/content_handler.php?l=$2&c=$3&name=$4 [L]

# C2, example: /lang/COUNTRY/content_page_title/content_item_id/
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/([A-Za-z0-9-_*]+)/([0-9]+)/()$ /intersell2-store/content_handler.php?l=$2&c=$3&name=$4&item_id=$5 [L]

# ------------------------------------------------------------------------------
# General handler for lang / country

# C3, example: /lang/COUNTRY/
RewriteRule ^/([^/]+)/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/(.*)$ /intersell2-store/$3?l=$2&c=$3 [QSA,L] 

# ------------------------------------------------------------------------------

# SECTION D: Std content items
# ------------------------------------------------------------------------------
# std content item

# D1, example: content_page_title(/)
RewriteRule ^/([^/]+)/([A-Za-z0-9-_*]+)(/?)$ /intersell2-store/content_handler.php?name=$2 [L]

# D2, example: content_page_title/content_item_id/
RewriteRule ^/([^/]+)/([A-Za-z0-9-_*]+)/([0-9]+)/()$ /intersell2-store/content_handler.php?name=$2&item_id=$3 [L]
RewriteRule ^/([^/]+)/([A-Za-z0-9-_*]+)/([0-9]+)/.*\.html$ /intersell2-store/content_handler.php?name=$2&item_id=$3 [L]

</VirtualHost>
<VirtualHost *:80>
  ServerName trend.d
  DocumentRoot /home/projects/trend/www/trend-store/
  
  LogFormat       "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined
  CustomLog       /var/log/httpd/trend-access.log combined
  ErrorLog        /var/log/httpd/trend-error.log  
  
  SetEnv APPLICATION_ENV "development"
  
  <IfModule mpm_itk_module>
    AssignUserId vagrant vagrant
  </IfModule>

  <Directory /home/projects/trend/www/trend-store>
    Order allow,deny
    Allow from all
    AllowOverride all
  </Directory>

# ------------------------------------------------------------------------------
# MOD-REWRITE RULES
# PLEASE NOTE! These rules are for local development only.
# They are NOT the same as the production ones found in
# the .htaccess file
# ------------------------------------------------------------------------------

RewriteEngine on

# Rule for IS2 sites
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
RewriteRule ^/graphics_cache/[0-9a-z][0-9a-z]/[0-9a-z][0-9a-z]/ /php/image/image_cache.php [QSA,L]

# Trend general redirects
RewriteRule ^/([A-Za-z0-9-_*]+)$ /trend/trend_redirect_handler.php?name=$1 [QSA,L]
RewriteRule ^/([A-Za-z0-9-_*]+)/([A-Za-z0-9-_*]+)$ /trend/trend_redirect_handler.php?name=$1&video=$2 [QSA,L]
RewriteRule ^/([A-Za-z0-9-_*=]+)/([A-Za-z0-9-_*]+)$ /product/product_detail.php?SKU=$1&Video=$2 [QSA,L]
RewriteRule ^/trend/video/([A-Za-z0-9-_*=]+)$ /trend/video/index.php?video=$1 [QSA,L]

# SECTION A: std rules
# ------------------------------------------------------------------------------
# Product detail links from product list

# A1, example: product/some_sku/search_type/search_param/product_title.html
RewriteRule ^/product/([A-Za-z0-9-_*=\.]+)/([0-9]+)/([A-Za-z0-9-_*\s\@\+]+)/(.+)\.html$ /product/product_detail.php?SKU=$1&list_type=$2&list_value=$3 [L]

# A2, example: product/some_sku/search_type/search_param/
RewriteRule ^/product/([A-Za-z0-9-_*=\.]+)/([0-9]+)/([A-Za-z0-9-_*\s\@\+]+)/$ /product/product_detail.php?SKU=$1&list_type=$2&list_value=$3 [L]

# ------------------------------------------------------------------------------
# Product detail direct links

# A3, example: product/some_sku/
RewriteRule ^/product/([A-Za-z0-9-_*=\.]+)/$ /product/product_detail.php?SKU=$1 [L]

# A4, example: product/some_sku/product_title.html
RewriteRule ^/product/([A-Za-z0-9-_*=\.]+)/([^/\.]+)\.html$ /product/product_detail.php?SKU=$1 [L]

# A4a, example: product/some_sku/product.title.html [ same as A4 but allows full stops in product title ]
RewriteRule ^/product/([A-Za-z0-9-_*=\.]+)/([^/]+)\.html$ /product/product_detail.php?SKU=$1 [L]

# A5, example: product/some_sku (currently can't allow skus with .'s as .php files match)
RewriteRule ^/product/([A-Za-z0-9-_*=]+)$ /product/product_detail.php?SKU=$1 [L]

# ------------------------------------------------------------------------------
# Product Groups & Product Lists

# A6, example: productgroup/prod_grp_id/prod_group_title.html
RewriteRule ^/productgroup/([0-9]+)/(.+)\.html$ /product/product_group_homepage.php?ProductGroupId=$1 [L]

# A7, example: productsubgroup1/prod_sub_grp1_id/prod_sub_grp1_title.html
RewriteRule ^/productsubgroup1/([0-9]+)/(.+)\.html$ /product/product_sub_group1_homepage.php?ProductSubGroup1Id=$1 [L]

# A8, example: productlist/list_type/list_param/list_title.html
RewriteRule ^/productlist/([0-9]+)/([A-Za-z0-9-_*\s+%']+)/([^\.]+)\.html$ /product/product_list.php?list_type=$1&list_value=$2 [L]

# ------------------------------------------------------------------------------


# SECTION B: lang / country
# ------------------------------------------------------------------------------
# Product detail links from product list

# B1, example: /lang/COUNTRY/product/some_sku/search_type/search_param/product_title.html
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=]+)/([0-9]+)/([A-Za-z0-9-_*]+)/(.+)\.html$ /product/product_detail.php?l=$1&c=$2&SKU=$3&list_type=$4&list_value=$5 [L]

# B2, example: /lang/COUNTRY/product/some_sku/search_type/search_param/
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=]+)/([0-9]+)/([A-Za-z0-9-_*]+)/$ /product/product_detail.php?l=$1&c=$2&SKU=$3&list_type=$4&list_value=$5 [L]

# ------------------------------------------------------------------------------
# Product detail direct links

# B3, example: /lang/COUNTRY/product/some_sku/
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=\.]+)/$ /product/product_detail.php?l=$1&c=$2&SKU=$3 [L]

# B4, example: /lang/COUNTRY/product/some_sku/product_title.html
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=\.]+)/([^/\.]+)\.html$ /product/product_detail.php?l=$1&c=$2&SKU=$3 [L]

# B5, example: /lang/COUNTRY/product/some_sku
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/product/([A-Za-z0-9-_*=]+)$ /product/product_detail.php?l=$1&c=$2&SKU=$3 [L]

# ------------------------------------------------------------------------------
# Product Groups & Product Lists

# B6, example: /lang/COUNTRY/productgroup/prod_grp_id/prod_group_title.html
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/productgroup/([0-9]+)/(.+)\.html$ /product/product_group_homepage.php?l=$1&c=$2&ProductGroupId=$3 [L]

# B7, example: /lang/COUNTRY/productsubgroup1/prod_sub_grp1_id/prod_sub_grp1_title.html
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/productsubgroup1/([0-9]+)/(.+)\.html$ /product/product_sub_group1_homepage.php?l=$1&c=$2&ProductSubGroup1Id=$3 [L]

# B8, example: /lang/COUNTRY/productlist/list_type/list_param/list_title.html
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/productlist/([0-9]+)/([0-9]+)/([^\.]+)\.html$ /product/product_list.php?l=$1&c=$2&list_type=$3&list_value=$4 [L]

# ------------------------------------------------------------------------------


# SECTION C: lang / country / content items
# ------------------------------------------------------------------------------
# lang / country content item

# C1, example: /lang/COUNTRY/content_page_title(/)
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/([A-Za-z0-9-_*]+)(/?)$ /content_handler.php?l=$1&c=$2&name=$3 [L]

# C2, example: /lang/COUNTRY/content_page_title/content_item_id/
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/([A-Za-z0-9-_*]+)/([0-9]+)/()$ /content_handler.php?l=$1&c=$2&name=$3&item_id=$4 [L]

# ------------------------------------------------------------------------------
# General handler for lang / country

# C3, example: /lang/COUNTRY/
RewriteRule ^/([A-Za-z][A-Za-z])/([A-Za-z][A-Za-z])/(.*)$ /$3?l=$1&c=$2 [QSA,L] 

# ------------------------------------------------------------------------------


# SECTION D: Std content items
# ------------------------------------------------------------------------------
# std content item

# D1, example: content_page_title(/)
RewriteRule ^/([A-Za-z0-9-_*]+)(/?)$ /content_handler.php?name=$1 [L]

# D2, example: content_page_title/content_item_id/
RewriteRule ^/([A-Za-z0-9-_*]+)/([0-9]+)/()$ /content_handler.php?name=$1&item_id=$2 [L]
RewriteRule ^/([A-Za-z0-9-_*]+)/([0-9]+)/.*\.html$ /content_handler.php?name=$1&item_id=$2 [L]

# ------------------------------------------------------------------------------

</VirtualHost>